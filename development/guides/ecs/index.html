
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://space-exodus.github.io/docs/development/guides/ecs/">
      
      
        <link rel="prev" href="../ui-survival/">
      
      
        <link rel="next" href="../basic-ui/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Руководство по ECS - Разработка Space Exodus</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#entity-components-systems-ecs" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../../.." title="Разработка Space Exodus" class="md-header__button md-logo" aria-label="Разработка Space Exodus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Разработка Space Exodus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Руководство по ECS
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Разработка Space Exodus" class="md-nav__button md-logo" aria-label="Разработка Space Exodus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Разработка Space Exodus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Главная
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Разработка
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Разработка
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Правила разработки
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Прототипы
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Регламент
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Регламент
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regulations/responsibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ответственность разработки
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Критические изменения
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Критические изменения
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../breaking-changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Что это за раздел
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../breaking-changes/28-05-2025-actions-ecs-overhaul/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Рефакторинг Actions под архитектуру ECS (28.05.2025)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" checked>
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Руководства
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Руководства
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Руководство по EUI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ui-survival/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Руководство по выживанию в мире UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Руководство по ECS
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Руководство по ECS
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Введение
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Основы
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Events: они же события
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        На практике
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="На практике">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 1. Компонент
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 2. Система
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 3. Прототип
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Итоги
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Пользовательский интерфейс
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    QA
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    QA
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Руководство по документации
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LVL-дизайн
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    LVL-дизайн
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Арт-Дизайн
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Арт-Дизайн
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spriting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Редактура вики
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Редактура вики
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../wiki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Лор
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Лор
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Введение
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Монолит
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Монолит
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/monolith/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Раздел
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/monolith/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Сектор "Коллос"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/monolith/PhaethonDynasty/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Династия Фаэтон
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/monolith/TransSolarFederation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Транс-Солнечная Федерация (ТСФ)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lore/monolith/UnitedSovietSocialistPlanets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Союз Советских Социалистических Планет
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Введение
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Основы
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Events: они же события
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        На практике
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="На практике">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 1. Компонент
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 2. Система
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 3. Прототип
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Итоги
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="entity-components-systems-ecs">Entity Components Systems (ECS)<a class="headerlink" href="#entity-components-systems-ecs" title="Permanent link">&para;</a></h1>
<p>Добро пожаловать в руководство по ECS. Данное руководство рассчитано на новичков и содержит лишь азы необходимые для работы.
Предполагается, что вы уже освоили клонирование репозитория, компилирование сборки и базовый прототипинг.</p>
<p>Здесь не будет речи и рассказов конкретно об архитектуре, а лишь руководство по работе с ней.</p>
<h2 id="_1">Введение<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Само название архитектуры кратко описывает суть всего происходящего в игре.</p>
<p>В первую очередь у нас есть <code>Entity</code> - это сущность, которой присвоен какой-либо идентификатор не равный нулю.
Это абсолютно любой объект в игре, стол, стул, грид, дверь, стена и так далее.</p>
<p>У нас есть <code>Components</code> - компоненты, наличие или отсутствие или различные параметры компонента дают различные свойства нашему <code>Entity</code>.
Например, есть компонент <code>PointLightComponent</code> - он превращает нашу сущность в лампу, заставляет её светится. В данном компоненте есть такие параметры как
<code>Energy</code> и <code>Radius</code>. <code>Energy</code> - количество энергии излучаемой <code>Entity</code>, чем это значение больше - тем ярче свет, <code>Radius</code> - радиус в тайлах в котором наш источник света светит, чем больше - тем более рассенным является <code>Energy</code> и если вы хотите сохранять прежнюю яркость при большем радиусе, то вам потребуется увеличить <code>Energy</code>. Стоит понимать, что сами по себе компоненты - не более чем контейнеры для данных, сами по себе они не имеют никакой логики, а чтобы наша лампа научилась светится для неё требуется собственная система освещения.</p>
<p><code>EntitySystem</code> - система, дающая логику компонентам. Сами по себе системы тоже не существуют, системы описывают исключительно <strong>логику</strong> и <strong>не имеют никаких данных</strong>. Также системы могут <strong>зависеть</strong> друг от друга, когда логика некоторых компонентов соприкасается и может изменяться от появления другого компонента.</p>
<p>Зарезюмируем, у нас есть объект - <code>Entity</code>, со свойствами описанными компонентами <code>Components</code>, которые воплощаются в жизнь посредством систем <code>EntitySystems</code>.</p>
<p>Что представляют собой прототипы? Прототипы, по своей сути, это просто конфигурационные файлы, содержащие параметры для компонентов. Важно осознать, что это не инструмент для программирования логики, а лишь инструмент конфигурации.</p>
<h2 id="_2">Основы<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Весь контент в нашей кодовой базе разбит на 3 ключевых части:<br>
- <code>Content.Server</code><br>
- <code>Content.Client</code><br>
- <code>Content.Shared</code></p>
<p><code>Content.Server</code> - это код, выполняющийся исключительно на стороне сервера, компоненты и системы созданные здесь недоступны со стороны клиента, недоступны из <code>Content.Client</code>.</p>
<p><code>Content.Client</code> - это код, выполняющийся исключительно на стороне клиента, так как компоненты и системы созданные в <code>Content.Server</code> нам здесь недоступны, то действительно и обратное - сервер не может получить доступа к системам и компонентам клиента, да и технически это сомнительно, поскольку сервер один, а клиентов много (каждый игрок - это отдельный клиент).</p>
<p><code>Content.Shared</code> - в свою очередь, это код, описывающий системы и компоненты доступные И со стороны сервера (<code>Content.Server</code>) И со стороны клиента (<code>Content.Client</code>). Например, здесь могут описываться структуры сетевых сообщений, посредством которых <code>Content.Server</code> и <code>Content.Client</code> обмениваются данными друг с другом. Также, код здесь может требоваться для механизма предсказания со стороны клиента (<code>Predictions</code>), но это отдельная сложная тема, которую я опишу уже в полном руководстве по Networking. </p>
<h2 id="events">Events: они же события<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<p><code>Events</code> (события) - это отдельный вид сообщений, работу с которыми полностью выполняет движок, оставляя нам простое API. <code>Event</code> позволяет нам по какому-либо событию выполнить какую-либо операцию, в контексте <code>RobustToolbox</code> большинство событий крепится на сущностях и их компонентах. Например, если предмет в активной руке был активирован, то на сущности всплывает <code>Event</code> под названием <code>UseInHandEvent</code>, <strong>подписавшись</strong> на данное событие посредством компонента, мы сможем выполнить какую-либо операцию.</p>
<p>Подписаться на события можно двумя разными способами: компонентом и глобально. Но у событий есть одно ограничение - подписаться на него можно лишь 1 раз при помощи 1 компонента. Глобально подписаться можно лишь 1 раз. Если коротко, то при подписывании на событие через компонент, то логика в нашей системе будет выполняться только когда событие было вызванно на сущность, имеющую какой-либо компонент, если нужного компонента нет, то наша система пропустит его. При подписке на событие глобально, независимо от того, на какой сущности событие было вызвано - мы всегда на него отреагируем. Обычно, вам никогда не понадобится глобально подписываться на событие, кроме редких исключений, использовать их без необходимости - плохо и неправильно, но помнить о такой технической возможности стоит.</p>
<h2 id="_3">На практике<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>Перейдём к практике на C#. Мы рассчитываем, что у вас уже есть репозиторий готовый для работы, в ином случае обратитесь к руководству по запуску локального сервера посредством компиляции сборки.</p>
<p>Разработаем следующий предмет - блюспейс-джаунтер, это предмет из Space Station 13, он выдаётся шахтёрам (утилизаторам) для того, чтобы из любой локации они могли легко переместится на случайную точку на станции. Применение простое, вы покидаете станцию, активируете джаунтер в активной руке - и вас телепортирует на случайную точку на станции. Обойдёмся без каких-либо эффектов для простоты руководства.</p>
<h3 id="1">Шаг 1. Компонент<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>Вы ведь внимательно читали <a href="#_1">Введение</a>? Чтобы наша сущность (<code>Entity</code>) получила свойство телепортировать в случайную точку на станции, нам нужно дать ему компонент. Так как логику пишем мы, то этот компонент создать должны мы.</p>
<p>В первую очередь давайте по-рассуждаем, а где должен быть компонент? У клиента? У сервера? Или он нужен им обоим? Можно подумать, "если клиенту нужно активировать предмет в своей руке, то, должно быть, он должен быть доступен клиенту", но это неверно. Так как вычисления должны происходить на стороне сервера (конечно, вам никто не мешает выполнить телепортацию на стороне клиента, только сервер не признает такую операцию и реальное положение персонажа останется там же, где он был, стоит понимать - у клиента есть власть только над <strong>отображением</strong> данных), то и располагаться компонент должен на сервере, а клиенту он не требуется, поскольку активация предметов происходит при помощи системы <code>InteractionSystem</code>, которая самостоятельно пробрасывает <strong>событие</strong> действия клиента на сервер.</p>
<p>Создадим для работы над данной задачей отдельную папку: <code>Content.Server/_Exodus/BluespaceJaunter</code>, создадим файл <code>BluespaceJaunterComponent.cs</code> с следующим содержимым:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Content.Server.Exodus.BluespaceJaunter</span><span class="p">;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="na">[RegisterComponent]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BluespaceJaunterComponent</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Component</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="p">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>Здесь всё просто, мы создаём класс <code>BluespaceJaunterComponent</code> который должен наследоваться от класса <code>Component</code> для добавления логики компонента, а после добавляем к нему аннотацию <code>RegisterComponent</code>, чтобы движок зарегистрировал его и он работал как надо. Какие-либо данные нам здесь не требуются, но вот пример того, как эти данные добавить:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Content.Server.Exodus.BluespaceJaunter</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="na">[RegisterComponent]</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BluespaceJaunterComponent</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Component</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">{</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="na">[DataField]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">TeleportDelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
По сути дела, вы просто добавляете свойство, к которому добавляется аннотация <code>DataField</code>. Данная аннотация, очевидно, нужна для того, чтобы игровой движок узнал о существовании нашего поля. Стоит знать, что для работы с этим полем нам, как разработчикам, эта аннотация не требуется, но показав это поле движку движок предоставляет вам:</p>
<ul>
<li>Во первых, возможность изменять свойство компонента посредством прототипа
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">entity</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SomeEntity</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">components</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BluespaceJaunter</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="nt">teleportDelay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.0</span>
</code></pre></div></td></tr></table></div>
Как вы могли заметить, окончание "Component" автоматически убирается, а название свойства указывается с нижнего регистра, если вы хотите, чтобы в коде свойство называлось одним образом, а в прототипе другим, то вы можете передать в аннотацию <code>DataField</code> название: <code>[DataField("delay")]</code> и тогда заместо "<code>teleportDelay</code>" в прототипе вам потребуется писать "<code>delay</code>". Вы также можете сделать это поле <strong>обязательным</strong> для указания в прототипе, если в прототипе это поле указано не будет, то движок создаст ошибку и данная сущность зарегистрирована не будет. Делается это посредством: <code>[DataField(required: true)]</code>, при комбинировании с названием: <code>[DataField("delay", required: true)]</code>.</li>
<li>Во вторых, инструменты для синхронизации данных, если этот компонент является сетевым. Здесь я подробно этот момент описывать не буду, а в отдельном руководстве, которое появится в будущем, описывающим работу с сетями (как только это станет актуально, я отредактирую текущее руководство и прикреплю ссылку).</li>
</ul>
<h3 id="2">Шаг 2. Система<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>Когда мы создали компонент, нам остаётся дать ему логику.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Content.Server.Exodus.BluespaceJaunter</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BluespaceJaunterSystem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">EntitySystem</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TransformSystem</span><span class="w"> </span><span class="n">_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">        </span><span class="n">SubscribeLocalEvent</span><span class="o">&lt;</span><span class="n">BluespaceJaunterComponent</span><span class="p">,</span><span class="w"> </span><span class="n">UseInHandEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">OnUseInHand</span><span class="p">);</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnUseInHand</span><span class="p">(</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">BluespaceJaunterComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">UseInHandEvent</span><span class="w"> </span><span class="n">ev</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Во первых, для работы <code>EntitySystem</code> нам не требуется никаких аннотаций, любой класс, который наследуется от <code>EntitySystem</code> и не имеющий модификатора <code>abstract</code> уже является пригодным к работе.</p>
<p>У <code>EntitySystem</code> есть собственные методы жизненного цикла, один из которых вы можете увидеть в коде - <code>void Initialize()</code>.<br>
- <code>void Initialize()</code> - вызывается при запуске игры, здесь обычно система подписывается на события<br>
- <code>void Update(float frameTime)</code> - вызывается каждый тик игры, количество тиков в секунду строго ограничено и определяется сервером<br>
- <code>void FrameUpdate(float frameTime)</code> - хоть и можно определить на сервере, используется только на клиенте каждый кадр, который отрисовывается. Если здесь будет слишком много вычислений, то это напрямую скажется на количестве отрисовываемых кадров<br>
- <code>void Shutdown()</code> - вызывается при закрытии игры/выключении сервера (вызывается не всегда, т. к. процесс игры могут убить системными командами, которые не дадут вообще никакого времени на подобные методы)</p>
<p>Также одна система может зависеть от другой, при необходимости выполнять какие-либо операции связанные с другими компонентами не вмешиваясь напрямую в их данные, чтобы не ломать логику связанных систем. Делается это посредством аннотации <code>[Dependency]</code>, <code>= default!</code> нам нужно для обмана компилятора, чтобы у нас не возникало никаких проблем при работе с данной зависимостью. Во первых, стоит понимать, что шаг инъекции зависимостей производится ПОСЛЕ конструкции класса, если вы сделаете что-то вроде:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span>
<span class="normal"><a href="#__codelineno-4-8">8</a></span>
<span class="normal"><a href="#__codelineno-4-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BluespaceJaunterSystem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">EntitySystem</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TransformSystem</span><span class="w"> </span><span class="n">_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">BluespaceJaunterSystem</span><span class="p">()</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">        </span><span class="n">_transform</span><span class="p">.</span><span class="n">SomeMethod</span><span class="p">();</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>То вы получите ошибку, говорящую о том, что <code>_transform</code> равен <code>null</code>. Но в методе <code>void Initialize</code> эти зависимости уже есть и там вы уже можете обращаться к ним без каких-либо проблем.</p>
<p>Подписывание на события происходит посредством метода <code>SubscribeLocalEvent&lt;Component, Event&gt;(Handler)</code>, где <code>Handler</code> - приватный метод текущей системы.</p>
<p>Также у нас есть ряд методов, используемых для оперирования компонентами:<br>
- <code>Component GetComp&lt;Component&gt;(EntityUid)</code> - возвращает указанный компонент, при отсутствии компонента выкинет не критическую ошибку, но неприятную, последствий много и заместо большой стены объяснений проще сказать, что этот метод не следует использовать без абсолютной уверенности в наличии нужного компонента.<br>
- <code>Component AddComp&lt;Component&gt;(EntityUid)</code> - добавляет сущности указанный компонент и возвращает его экземпляр для дальнейшей работы<br>
- <code>bool TryGetComp&lt;Component&gt;(EntityUid, out var Component?)</code> - проверяет наличие компонента, если компонент отсутствует, то вернёт значение <code>false</code>, а компонент в конструкции <code>out var</code> будет равен <code>null</code>, если компонент имеется, то вернёт значение <code>true</code>, а в <code>out var</code> сам компонент. Также следует отметить о наличии метки для компилятора, которая выполняет проверку на <code>null</code> и заместо сравнений с <code>null</code> вы можете проверить только значение <code>bool</code>, которое вернул метод. Если коротко, то применяется он так:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">TryComp</span><span class="o">&lt;</span><span class="n">Component</span><span class="o">&gt;</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">component</span><span class="p">))</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="c1">// мы получили false</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="c1">// здесь component == null</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// прерываем выполнение</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="n">component</span><span class="p">.</span><span class="n">property</span><span class="p">;</span><span class="w"> </span><span class="c1">// НЕ null, поскольку компилятор понимает, что если бы компонент был null, то до сюда поток выполнения не дошёл</span>
</code></pre></div></td></tr></table></div></p>
<p>Перейдём к непосредственно нашему заданию - блюспейс-джаунтер.
Нам нужно сначала получить текущий грид станции, обратимся для этого к системе станции:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Content.Server.Exodus.BluespaceJaunter</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BluespaceJaunterSystem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">EntitySystem</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">StationSystem</span><span class="w"> </span><span class="n">_station</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IRobustRandom</span><span class="w"> </span><span class="n">_random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">MapSystem</span><span class="w"> </span><span class="n">_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="na">[Dependency]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TransformSystem</span><span class="w"> </span><span class="n">_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">        </span><span class="n">SubscribeLocalEvent</span><span class="o">&lt;</span><span class="n">BluespaceJaunterComponent</span><span class="p">,</span><span class="w"> </span><span class="n">UseInHandEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">OnUseInHand</span><span class="p">);</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnUseInHand</span><span class="p">(</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">BluespaceJaunterComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">UseInHandEvent</span><span class="w"> </span><span class="n">ev</span><span class="p">)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">        </span><span class="c1">// если мы не смогли получить станцию - прерываем выполнение, нам некуда телепортироваться</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">TryGetStation</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">station</span><span class="p">))</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">        </span><span class="c1">// получаем случайный тайл для телепортации</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetRandomTile</span><span class="p">(</span><span class="n">station</span><span class="p">);</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">        </span><span class="c1">// непосредственная телепортация</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">        </span><span class="n">_transform</span><span class="p">.</span><span class="n">SetCoordinates</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">User</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EntityCoordinates</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="n">GridIndices</span><span class="p">));</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">    </span><span class="c1">// логика получения станции декомпозирована в отдельный метод на случай необходимости в большем количестве логики</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGetStation</span><span class="p">(</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">BluespaceJaunterComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">NotNullWhen</span><span class="p">(</span><span class="k">true</span><span class="p">)]</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">MapGridComponent</span><span class="o">&gt;?</span><span class="w"> </span><span class="n">station</span><span class="p">)</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">        </span><span class="n">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">stations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_station</span><span class="p">.</span><span class="n">GetStations</span><span class="p">();</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">        </span><span class="c1">// Обычно, у нас невозможна ситуация, когда блюспейс-джаунтер будет активирован без станции,</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">        </span><span class="c1">// но мы должны обработать такую ситуацию, если она предусмотрена технически, чтобы не произошло критических ошибок</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stations</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="w">        </span><span class="c1">// технически у нас предусмотрена возможность наличия множества станций, но геймплейно - нет, у нас нет в условии задания уточнений про множество станций, так что просто возьмём самую первую из списка</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">stationUid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stations</span><span class="p">.</span><span class="n">First</span><span class="p">();</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">TryComp</span><span class="o">&lt;</span><span class="n">MapGridComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">stationUid</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">grid</span><span class="p">))</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="w">        </span><span class="n">station</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">stationUid</span><span class="p">,</span><span class="w"> </span><span class="n">grid</span><span class="p">);</span><span class="w"> </span><span class="c1">// кортеж вида (EntityUid, Component) может неявно преобразовываться в Entity&lt;Component&gt;</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">TileRef</span><span class="w"> </span><span class="nf">GetRandomTile</span><span class="p">(</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">MapGridComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_map</span><span class="p">.</span><span class="n">GetAllTiles</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">grid</span><span class="p">.</span><span class="n">Comp</span><span class="p">);</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_random</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">tiles</span><span class="p">.</span><span class="n">ToList</span><span class="p">());</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Система готова!</p>
<h3 id="3">Шаг 3. Прототип<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p>Не могло же всё закончиться? Пора вернуться к истокам, к прототипам! Прототипы - это, по своей сути, конфигурационные файлы для компонентов.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">entity</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BluespaceJaunter</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bluespace jaunter</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A device that uses experimental bluespace technology to teleport the user to a random location on the station.</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="nt">components</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Item</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sprite</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="nt">sprite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Objects/Tools/jumper.rsi</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">icon</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BluespaceJaunter</span>
</code></pre></div></td></tr></table></div>
Все остальные свойства вы можете выбрать на своё усмотрение.</p>
<h2 id="_4">Итоги<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>В данном руководстве мы рассмотрели основы работы с ECS в кодовой базе Space Station 14.
Помните о том, что вы должны всегда использовать существующие системы, если вам нужно что-либо сделать со сторонним компонентом.
Перед тем, как реализовывать какой-либо метод проверяйте, не реализован ли он уже в какой-то другой системе.</p>
<p>Далее вам следует освоить сетевой обмен и синхронизацию данных, но пока такого руководства нет, практикуйтесь и не стесняйтесь задавать вопросы более опытным разработчикам!</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Принадлежит и поддерживается Space Exodus. Распространяется под <a style="color: var(--md-typeset-a-color);" href="https://github.com/space-exodus/space-exodus.github.io/blob/master/LICENSE">проприетарной лицензией</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>